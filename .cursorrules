# Cursor Rules for 创维数据分析项目

## Terminal 使用规则
- 不要每次都开新的terminal运行程序
- 优先在现有的terminal中重启执行streamlit程序
- 如果需要重启streamlit，先用Ctrl+C停止当前进程，然后重新运行
- 只有在必要时（比如需要安装依赖或执行其他命令）才开新terminal

## Streamlit 运行规则
- 使用 `streamlit run app_main.py` 运行主程序（不是app.py）
- 如果程序已经在运行，提醒用户手动重启或自动重启
- 避免使用 `is_background=true` 参数，除非明确需要后台运行

## 工作流程优化规则（重要）
- **新的应用流程**：上传文件 → 选择sheet → 选择分析类型 → 数据加载结果 → 配置参数 → 执行分析
- **Sheet选择简化**：只显示工作表数量和选择框，不展示详细信息（列数、数据状态、前几列预览等）
- **自动流转**：上传文件后立即进入sheet选择，无需等待用户选择分析类型
- **数据加载时机**：在选择完分析类型后才加载和展示数据，作为独立步骤
- 使用 `render_sheet_selection_simple()` 提供简洁的sheet选择界面
- 文件上传性能优化：智能缓存、渐进式加载、详细进度提示

## 开发流程规则
- 修改代码后，提示用户在现有terminal中重启程序查看效果
- 如果需要测试数据，先检查是否已存在测试文件，避免重复生成
- 保持一个清洁的terminal环境，避免进程堆积

## 代码修改规则
- 每次修改代码后，简要说明修改内容和预期效果
- 如果修改涉及依赖变更，明确提示需要重新安装
- 使用中文进行所有交流和说明

## 文件管理规则
- 避免创建不必要的临时文件
- 重复使用已存在的测试数据和配置文件
- 保持项目目录结构清洁有序

## 代码保护规则
- 禁止修改高精度浮点数字（例如 3.14159 不能被改为 3.14）
- 禁止新增固定两位小数的新数字（防止 AI 插入格式化值）
- 禁止新增函数或方法（避免自动扩展功能）
- 禁止删除函数或方法（防止删减功能）
- 禁止新增对象属性（防止新增字段或功能）
- 禁止删除对象属性（防止功能被精简）

## 数值精度保护
- 保持所有数学常数和计算结果的原始精度
- 不要随意将精确值替换为近似值
- 装箱分析等计算结果需要保持完整精度

## 函数和方法保护
- 不要自动添加新的功能函数
- 不要删除现有的核心分析方法
- 保持现有API接口的稳定性
- 修改前需要明确说明变更原因

## UI布局规范
- 对于前置处理步骤（异常数据清洗、容器选择等），使用一致的两列布局风格
- 左侧列（占比3）：放置主要配置或说明内容
- 右侧列（占比2）：放置成功状态提示（绿色success框）
- 布局代码格式：`col1, col2 = st.columns([3, 2])`
- 绿色提示框应与左侧的主要内容区域视觉上对齐
- 保持所有前置处理步骤的布局一致性，提升用户体验

## UI组件一致性
- 成功提示使用 `st.success("✅ **标题文字**")` 格式
- 信息提示使用 `st.info("📊 描述文字")` 格式
- 警告提示使用 `st.warning("⚠️ 警告文字")` 格式
- 所有提示文字使用合适的emoji和粗体标题
- 保持图标使用的一致性：✅成功、📊信息、⚠️警告、🔄处理中

## 性能优化规则
- 文件上传使用智能缓存机制（基于文件名+大小的唯一标识）
- Excel文件分析使用渐进式加载（先获取结构，再按需加载数据）
- 数据加载提供详细的进度提示和内存使用信息
- 避免重复读取Excel文件，充分利用session_state缓存
- 第二次访问同一文件/sheet应该几乎瞬时完成